[[extend 'layout.html']]

<!-- [[block page_head]]
<title>Recipe Manager</title>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
[[end]]
-->

<!--
[[block page_scripts]]
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.21/vue.global.prod.min.js"></script>
<script src="[[=URL('static', 'js/index.js')]]"></script>
[[end]]
-->
<head>
    <link rel="stylesheet" href="/recipe/static/css/home.css">
</head>

<div id="app">
    <div class="welcome">
        <strong>Welcome [[=user['first_name']]]</strong>
    </div>
    <div class="columns">
        <div class="column">
            <div>
                <strong>Ingredients</strong>
                [[=ingredients_form]]
            </div>
            <hr>
            <div>
                <strong>Recipes</strong>
                <button id="openRecipeForm">Add New Recipe</button>
            </div>
        </div>
        <!-- Modal -->
        <div id="recipeModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2><strong>New Recipe</strong></h2>
                [[=recipes_form]]
            </div>
        </div>

        <div class="column">
            <div class="field">
                <p><strong>Recipes</strong></p>
                <label class="label">Search Recipes</label>
                <div class="control">
                    <input class="input" type="text" placeholder="Search by name or type..."
                        @keyup="search_recipes($event.target.value)" />
                    <article v-for="recipe in filtered_recipes">
                        <!-- display all recipe cards that match the search query -->
                        <div class="card mb-3">
                            <header class="card-header">
                                <div class="card-header-title">
                                    <div class="card-header-title">{{recipe.name}}</div>
                                    <div class="card-content">Type: {{recipe.type}}</div>
                                </div>
                            </header>
                            <div class="card-content">
                                <img v-if="recipe.image" :src="`/recipe/download/${recipe.image}`" alt="Recipe Image" />
                                <div><strong>Description: </strong> </div>
                                <div>{{recipe.description}}</div>
                                <div><strong>Instructions: </strong> </div>
                                <div>{{recipe.instruction_steps}}</div>
                                <div><strong>Servings: </strong> {{recipe.servings}}</div>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
        </div>
        <div class="column">
            <div class = "field">
                <label class="label">Search Ingredients</label>
                <div class="control">
                    <input
                        class="input"
                        type="text"
                        placeholder="Search by name..."
                        v-model="new_ingredient.name"
                        v-on:keyup="search()"   
                    />
                    <p><strong>Ingredients</strong></p>
                    <li v-for="ingredient in selected_ingredients">
                        <p><strong>Name:</strong>{{ ingredient.name }}</p>
                        <p><strong>Unit:</strong>{{ ingredient.unit }}</p>
                        <p><strong>Description:</strong> 
                            {{ ingredient.description }}</p>
                        <p><strong>Calories Per Unit: </strong>
                        {{ingredient.calories_per_unit}}</p>
                        <hr>
                    </li>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const modal = document.getElementById("recipeModal");
    const openBtn = document.getElementById("openRecipeForm");
    const closeBtn = modal.querySelector(".close");

    openBtn.onclick = () => modal.style.display = "block";
    closeBtn.onclick = () => modal.style.display = "none";

    window.onclick = function (event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };
});
</script>